# JWT 는 어디에 저장해야하는가

- 웹 클라이언트에서 무언가를 저장하기 위해 사용하는 공간은 `쿠키`와 `웹 스토리지`로 나눌 수 있다.
- `웹 스토리지`는 로컬 스토리지와 세션 스토리지로 나뉘어진다.
    - 크롬 개발자 도구를 통해 확인할 수 있다.
- 쿠키와 웹 스토리지 중 둘중에 어느 곳에 저장하는게 좋을지 두 저장소의 차이를 알아보자.

<br>

----------

## 쿠키 vs 스토리지

### 쿠키

- Stateless 한 Http 통신의 무상태성을 보완하기 위해 사용
- **자동으로 Http 헤더에 포함된다.**
- 서버에서 접근이 가능하다.
- HttpOnly 설정을 추가한다면 클라이언트의 접근을 차단할 수 있다.
    - 서버에서 설정할 수 있다.
- Http Response 는 set-cookie 를 통해 클라이언트에 쿠키를 설정한다.
- 작은 저장 공간을 가진다 (4KB)
- 만료 기간은 서버측 또는 클라이언트측에서 설정할 수 있습니다.
    - 클라이언트 : session cookies
    - 서버 : persistent cookies

<br>
<br>

### 세션 스토리지

- 세션을 위한 저장 공간
    - 세션 스토리지는 session cookies 와 비슷
- 세션이 종료되면 모두 삭제된다.
- 쿠키와 다르게 서버에서 접근을 할 수 없기에 클라이언트에서 스토리지 값을 꺼내 서버에 전달해야한다.
- 저장 공간은 5 ~ 10MB를 가진다.

<br>
<br>

### 로컬 스토리지

- 로컬 스토리지는 persistent cookies 와 비슷
- 쿠키는 만료기간이 지나면 삭제되지만 로컬 스토리지는 반 영구적으로 저장 가능
- 서버에서 접근을 할 수 없기에 클라이언트에서 스토리지 값을 꺼내 서버에 전달해야한다.
- 저장 공간은 5 ~ 10MB를 가진다.

<br>
<br>

--------

## 그래서 어디에 토큰을 저장해야해?

- 보안적인 측면에서 웹 스토리지는 좋지 못하다.
    - 웹 스토리지에 저장된 토큰은 클라이언트에서 꺼내서 전달해야하기 때문에 javascript 에서 언제든지 접근이 가능하다.
    - 고로 XSS 공격에 취약하다.
- 그러면 쿠키에 저장하면 되남?
    - 쿠키에 저장한 값은 HttpOnly 속성을 통해 javascript 접근을 막을 수 있다.
    - XSS 공격을 막을 수 있을지라도 (완벽한 방어는 없다. 단지 공격자가 귀찮을 뿐) **CSRF 공격에 취약**하다고 한다.
    - 왜냐하면 쿠키는 모든 요청에 전송되기 때문에 사용자가 로그인 한 경우 CSRF에 취약하다.
    - 최근에는 쿠키의 CSRF 취약점을 막기 위해 쿠키의 SAME-SITE 속성과 js의 fetch api 속성의 기본값 등으로 request 에 쿠키를 싣지 않음 이 설정되어있다.
    - ~~쿠키 기반 인증을 사용할 때 CSRF 토큰을 사용하는 것~~
    - 좀 더 찾아볼 것 북마크 활용

[참고 1 - javable](https://woowacourse.github.io/javable/post/2020-08-31-where_to_store_token/)

